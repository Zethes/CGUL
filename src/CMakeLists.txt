# Jatta - General Utility Library
# Copyright (C) 2012-2013, Joshua Brookover and Amber Thrall
# All rights reserved.

# Setup compiler settings
SET(JATTA_DEFINITIONS ${JATTA_DEFINITIONS} -DJATTA_INCLUDES -DGLEW_NO_GLU -DWIN32_LEAN_AND_MEAN -DNOMINMAX -DJATTA_BUILD)
#IF(NOT APPLE AND NOT MSVC)
#    SET(CMAKE_CXX_FLAGS "-std=c++0x -MD -Os -s -g -Wall ${CMAKE_CXX_FLAGS}")
#ENDIF()
#IF(MSVC)
#    SET(CMAKE_CXX_FLAGS "/EHsc ${CMAKE_CXX_FLAGS}")
#    SET(JATTA_DEFINITIONS ${JATTA_DEFINITIONS} -DMSVC)
#ENDIF()
#IF(APPLE)
#    SET(CMAKE_CXX_FLAGS "-std=c++0x -ObjC++ -Wall ${CMAKE_CXX_FLAGS}")
#ENDIF()
SET(CMAKE_CXX_FLAGS "-I${JATTA_DEPENDENCY_DIR}/include ${CMAKE_CXX_FLAGS}")
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRENT_SOURCE_DIR})

# Test C++ for features
ADD_SUBDIRECTORY(Tests)
SET(CMAKE_CXX_FLAGS "${JATTA_FLAGS} ${CMAKE_CXX_FLAGS}")
MESSAGE(STATUS "CXX_FLAGS: ${CMAKE_CXX_FLAGS}")

# Setup cache variables
INCLUDE(Scripts/Cache.cmake)

INCLUDE(Scripts/Modules.cmake)

# Initialize SimpleSource
INCLUDE(Scripts/SimpleSource.cmake)
SIMPLESOURCE_INIT(ON JATTA_SOURCE)

# Add the source subdirectories
ADD_SUBDIRECTORY(Jatta/Assimp)
ADD_SUBDIRECTORY(Jatta/Audio)
ADD_SUBDIRECTORY(Jatta/Collision)
ADD_SUBDIRECTORY(Jatta/Containers)
ADD_SUBDIRECTORY(Jatta/External)
ADD_SUBDIRECTORY(Jatta/File)
ADD_SUBDIRECTORY(Jatta/Fonts)
ADD_SUBDIRECTORY(Jatta/Images)
ADD_SUBDIRECTORY(Jatta/Math)
ADD_SUBDIRECTORY(Jatta/Network)
ADD_SUBDIRECTORY(Jatta/OpenGL)
ADD_SUBDIRECTORY(Jatta/Utility)
ADD_SUBDIRECTORY(Jatta/Windows)

# Add the Jatta.h file to the list of source files
SET(JATTA_SOURCE ${JATTA_SOURCE} Jatta.h)
INSTALL(FILES Jatta.h DESTINATION include/)
INSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/Jatta/Config.h DESTINATION include/Jatta/)

# Set the output directory to the user defined one or the default one
IF(NOT JATTA_OUTPUT_DIR STREQUAL "")
    SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${JATTA_OUTPUT_DIR})
    SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_DEBUG ${JATTA_OUTPUT_DIR})
    SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELEASE ${JATTA_OUTPUT_DIR})
    SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${JATTA_OUTPUT_DIR})
    SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG ${JATTA_OUTPUT_DIR})
    SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE ${JATTA_OUTPUT_DIR})
    SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${JATTA_OUTPUT_DIR})
ENDIF()

# Set the include directories
SET(JATTA_INCLUDES ${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRENT_SOURCE_DIR} PARENT_SCOPE)

# Make all of the files Obj-C++ on Mac / Xcode
#IF(CMAKE_GENERATOR EQUAL "Xcode")
#    SET_SOURCE_FILES_PROPERTIES(${JATTA_SOURCE} PROPERTIES COMPILE_FLAGS "-x objective-c++")
#ENDIF()
IF(APPLE)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -x objective-c++")
ENDIF()

# Create the Jatta library
ADD_LIBRARY(Jatta SHARED ${JATTA_SOURCE})

# Finalize SimpleSource
SIMPLESOURCE_FINISH()

INCLUDE(Scripts/Resources.cmake)

TARGET_LINK_LIBRARIES(Jatta ${JATTA_LIBRARIES})

ADD_DEFINITIONS(${JATTA_DEFINITIONS})

INSTALL(TARGETS Jatta DESTINATION lib/)

INCLUDE(Scripts/Acknowledgements.cmake)

CONFIGURE_FILE("Jatta/Config.h.in" "Jatta/Config.h")